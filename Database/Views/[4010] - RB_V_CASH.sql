--------------------------------------------------------
--  DDL for View RB_V_CASH
--------------------------------------------------------

CREATE OR REPLACE NOFORCE VIEW "RB_V_CASH" (
  COD_SCENARIO,
  COD_PERIODO,
  COD_AZIENDA,
  COD_AZI_CTP,
  COD_CONTO,
  COD_CATEGORIA,
  COD_DEST1,
  COD_DEST2,
  COD_DEST2_CTP,
  COD_DEST3,
  COD_DEST4,
  COD_DEST5,
  COD_VALUTA,
  COD_VALUTA_ORIGINARIA,
  TGK_TABLE_SEGMENT,
  RB_ROWID,
  MONTH_END_DATE,
  REPORTING_ENTITY,
  COD_REPORTING_ENTITY,
  INSTRUMENT,
  SOURCE,
  INTERCOMPANY,
  CALL_CODE,
  CURRENCY_CODE,
  FOREIGN_AMOUNT,
  BASE_EQUIVALENT,
  CASH_ACCT_NBR,
  CASH_ACCOUNT_NAME,
  CUSTOMER_ID,
  CUSTOMER_NAME,
  CUSTOMER_TYPE,
  BRANCH_AGENCY_002,
  HOLDING_COM_Y9C,
  FOREIGN_DOMESTIC,
  COUNTRY_DESC,
  CONSOL_NODE,
  LEGAL_ENTITY,
  PRIMARY_GL_NBR,
  GL_KEY_CODE,
  GL_AMNT_IFRS,
  GL_AMNT_USGAAP,
  ACCRUED_INTEREST,
  HIGHLVL_PROD_CAT,
  IN_COLLECTION,
  CURR_AND_COIN,
  INTEREST_BEARING,
  FED_RESERVE,
  DEPOSIT_OR_NONDEP,
  CAPITAL_RISK_RATE,
  FOREIGN,
  DOMESTIC,
  OTHER_CASH,
  PRODUCT_TYPE,
  CUSTOMER_TYPE_PX,
  CUST_RELATION_PX,
  CUST_RELATION_GL,
  CUSTOMER_TYPE_GL,
  COUNTRY_CODE,
  CONSOL_BU_NODE,
  BUS_UNIT_NAME,
  BUSINESS_UNIT,
  ACCOUNT,
  ACCOUNT_NAME,
  PRODUCT,
  PRODUCT_NAME,
  OPERATING_UNIT,
  DEPTID,
  AFFILIATE,
  AFFILIATE_NAME,
  AFFL_CONSOL_NODE,
  CUST_CLASS,
  BU_AFFL_CHECK,
  ACCT_AFFL_CHECK,
  DESCRIPTION,
  FILLER_1,
  FILLER_2,
  FILLER_3,
  FILLER_4,
  FILLER_5,
  FILLER_6,
  FILLER_7,
  FILLER_8,
  FILLER_9,
  FILLER_10,
  FILLER_11,
  FILLER_12,
  FILLER_13,
  FILLER_14,
  FILLER_15,
  FILLER_16,
  FILLER_17,
  FILLER_18,
  FILLER_19,
  FILLER_20,
  FILLER_21,
  FILLER_22,
  FILLER_23,
  FILLER_24,
  FILLER_25,
  PROVENIENZA,
  USERUPD,
  DATEUPD
) AS 
SELECT
  RB_F_TGK_CREATE_SCENARIO_CODE(KEYS.MONTH_END_DATE) AS COD_SCENARIO,
  RB_F_TGK_CREATE_PERIOD_CODE(KEYS.MONTH_END_DATE) AS COD_PERIODO,
  RB_F_TGK_SANITIZE_CODE(DATA.BUSINESS_UNIT) AS COD_AZIENDA,
  RB_F_TGK_SANITIZE_CODE(DATA.AFFILIATE) AS COD_AZI_CTP,
  RB_F_TGK_SANITIZE_CODE(DATA.GL_KEY_CODE) AS COD_CONTO,
  'ORI' AS COD_CATEGORIA,
  RB_F_TGK_SANITIZE_CODE(DATA.ACCOUNT) AS COD_DEST1,
  CASE WHEN DATA.OPERATING_UNIT IS NOT NULL THEN 'BLC_'||RB_F_TGK_SANITIZE_CODE(DATA.OPERATING_UNIT) 
  WHEN DATA.DEPTID IS NOT NULL THEN 'DPT_'||RB_F_TGK_SANITIZE_CODE(DATA.DEPTID) 
  ELSE RB_F_TGK_SANITIZE_CODE(NULL)
  END AS COD_DEST2,
  RB_F_TGK_SANITIZE_CODE(CAST(NULL AS VARCHAR2(30))) AS COD_DEST2_CTP,
  RB_F_TGK_SANITIZE_CODE(DATA.PRODUCT) AS COD_DEST3,
  RB_F_TGK_SANITIZE_CODE(DATA.CUST_CLASS) AS COD_DEST4,
  RB_F_TGK_SANITIZE_CODE(DATA.CALL_CODE) AS COD_DEST5,
  A.COD_VALUTA,
  DATA.CURRENCY_CODE AS COD_VALUTA_ORIGINARIA,
  DATA.TGK_TABLE_SEGMENT,
  KEYS.RB_ROWID,
  KEYS.MONTH_END_DATE,
  KEYS.REPORTING_ENTITY,
  RB_F_TGK_SANITIZE_CODE(KEYS.REPORTING_ENTITY) AS COD_REPORTING_ENTITY,
  DATA.INSTRUMENT,
  DATA.SOURCE,
  DATA.INTERCOMPANY,
  DATA.CALL_CODE,
  DATA.CURRENCY_CODE,
  DATA.FOREIGN_AMOUNT,
  DATA.BASE_EQUIVALENT,
  DATA.CASH_ACCT_NBR,
  DATA.CASH_ACCOUNT_NAME,
  DATA.CUSTOMER_ID,
  DATA.CUSTOMER_NAME,
  DATA.CUSTOMER_TYPE,
  DATA.BRANCH_AGENCY_002,
  DATA.HOLDING_COM_Y9C,
  DATA.FOREIGN_DOMESTIC,
  DATA.COUNTRY_DESC,
  DATA.CONSOL_NODE,
  DATA.LEGAL_ENTITY,
  DATA.PRIMARY_GL_NBR,
  DATA.GL_KEY_CODE,
  DATA.GL_AMNT_IFRS,
  DATA.GL_AMNT_USGAAP,
  DATA.ACCRUED_INTEREST,
  DATA.HIGHLVL_PROD_CAT,
  DATA.IN_COLLECTION,
  DATA.CURR_AND_COIN,
  DATA.INTEREST_BEARING,
  DATA.FED_RESERVE,
  DATA.DEPOSIT_OR_NONDEP,
  DATA.CAPITAL_RISK_RATE,
  DATA.FOREIGN,
  DATA.DOMESTIC,
  DATA.OTHER_CASH,
  DATA.PRODUCT_TYPE,
  DATA.CUSTOMER_TYPE_PX,
  DATA.CUST_RELATION_PX,
  DATA.CUST_RELATION_GL,
  DATA.CUSTOMER_TYPE_GL,
  DATA.COUNTRY_CODE,
  DATA.CONSOL_BU_NODE,
  DATA.BUS_UNIT_NAME,
  DATA.BUSINESS_UNIT,
  DATA.ACCOUNT,
  DATA.ACCOUNT_NAME,
  DATA.PRODUCT,
  DATA.PRODUCT_NAME,
  DATA.OPERATING_UNIT,
  DATA.DEPTID,
  DATA.AFFILIATE,
  DATA.AFFILIATE_NAME,
  DATA.AFFL_CONSOL_NODE,
  DATA.CUST_CLASS,
  DATA.BU_AFFL_CHECK,
  DATA.ACCT_AFFL_CHECK,
  DATA.DESCRIPTION,
  DATA.FILLER_1,
  DATA.FILLER_2,
  DATA.FILLER_3,
  DATA.FILLER_4,
  DATA.FILLER_5,
  DATA.FILLER_6,
  DATA.FILLER_7,
  DATA.FILLER_8,
  DATA.FILLER_9,
  DATA.FILLER_10,
  DATA.FILLER_11,
  DATA.FILLER_12,
  DATA.FILLER_13,
  DATA.FILLER_14,
  DATA.FILLER_15,
  DATA.FILLER_16,
  DATA.FILLER_17,
  DATA.FILLER_18,
  DATA.FILLER_19,
  DATA.FILLER_20,
  DATA.FILLER_21,
  DATA.FILLER_22,
  DATA.FILLER_23,
  DATA.FILLER_24,
  DATA.FILLER_25,
  DATA.PROVENIENZA,
  DATA.USERUPD,
  DATA.DATEUPD
FROM
  (
    SELECT DISTINCT      
      MONTH_END_DATE,
      REPORTING_ENTITY,
      RB_ROWID
    FROM
      RB_HST_CASH_01
  ) KEYS
  INNER JOIN
  (
    SELECT
        TGK_TABLE_SEGMENT,
        RB_ROWID,
        MONTH_END_DATE,
        REPORTING_ENTITY,
        INSTRUMENT,
        SOURCE,
        INTERCOMPANY,
        CALL_CODE,
        CURRENCY_CODE,
        FOREIGN_AMOUNT,
        BASE_EQUIVALENT,
        CASH_ACCT_NBR,
        CASH_ACCOUNT_NAME,
        CUSTOMER_ID,
        CUSTOMER_NAME,
        CUSTOMER_TYPE,
        BRANCH_AGENCY_002,
        HOLDING_COM_Y9C,
        FOREIGN_DOMESTIC,
        COUNTRY_DESC,
        CONSOL_NODE,
        LEGAL_ENTITY,
        PRIMARY_GL_NBR,
        GL_KEY_CODE,
        GL_AMNT_IFRS,
        GL_AMNT_USGAAP,
        ACCRUED_INTEREST,
        HIGHLVL_PROD_CAT,
        IN_COLLECTION,
        CURR_AND_COIN,
        INTEREST_BEARING,
        FED_RESERVE,
        DEPOSIT_OR_NONDEP,
        CAPITAL_RISK_RATE,
        FOREIGN,
        DOMESTIC,
        OTHER_CASH,
        PRODUCT_TYPE,
        CUSTOMER_TYPE_PX,
        CUST_RELATION_PX,
        CUST_RELATION_GL,
        CUSTOMER_TYPE_GL,
        COUNTRY_CODE,
        CONSOL_BU_NODE,
        BUS_UNIT_NAME,
        BUSINESS_UNIT,
        ACCOUNT,
        ACCOUNT_NAME,
        PRODUCT,
        PRODUCT_NAME,
        OPERATING_UNIT,
        DEPTID,
        AFFILIATE,
        AFFILIATE_NAME,
        AFFL_CONSOL_NODE,
        CUST_CLASS,
        BU_AFFL_CHECK,
        ACCT_AFFL_CHECK,
        DESCRIPTION,
        FILLER_1,
        FILLER_2,
        FILLER_3,
        FILLER_4,
        FILLER_5,
        FILLER_6,
        FILLER_7,
        FILLER_8,
        FILLER_9,
        FILLER_10,
        FILLER_11,
        FILLER_12,
        FILLER_13,
        FILLER_14,
        FILLER_15,
        FILLER_16,
        FILLER_17,
        FILLER_18,
        FILLER_19,
        FILLER_20,
        FILLER_21,
        FILLER_22,
        FILLER_23,
        FILLER_24,
        FILLER_25,
        PROVENIENZA,
        USERUPD,
        DATEUPD
    FROM
      RB_HST_CASH_01
  ) DATA
  ON
    KEYS.MONTH_END_DATE = DATA.MONTH_END_DATE
    AND KEYS.RB_ROWID = DATA.RB_ROWID
    AND KEYS.REPORTING_ENTITY = DATA.REPORTING_ENTITY
  LEFT OUTER JOIN
  AZIENDA A
  ON
	DATA.BUSINESS_UNIT = A.COD_AZIENDA
;