--------------------------------------------------------
--  DDL for View RB_V_BORROWINGS
--------------------------------------------------------
SET DEFINE OFF;
CREATE OR REPLACE NOFORCE VIEW "RB_V_BORROWINGS" (
	COD_SCENARIO,
	COD_PERIODO,
	COD_AZIENDA,
	COD_AZI_CTP,
	COD_CONTO,
	COD_CATEGORIA,
	COD_DEST1,
	COD_DEST2,
	COD_DEST2_CTP,
	COD_DEST3,
	COD_DEST4,
	COD_DEST5,
	COD_VALUTA,
	COD_VALUTA_ORIGINARIA,
	COD_REPORTING_ENTITY,
	RB_ROWID,
	MONTH_END_DATE,
	REPORTING_ENTITY,
	INSTRUMENT,
	INTERCOMPANY,
	CALL_CODE,
	CALL_CODE_DESC,
	GL_KEY_CODE,
	GL_KEY_CODE_DESC,
	CONSOL_NODE,
	BUSINESS_UNIT,
	CURRENCY_CODE,
	FOREIGN_AMOUNT,
	CURRENCY_USQ,
	BASE_EQUIVALENT,
	MATURITY_DATE,
	REMAINING_MATURITY_DAYS,
	MATURITY_BUCKETS,
	MATURITY_BUCKETS_2,
	CUSTOMER_ID,
	"DEPO_NON-DEPO",
	FOREIGN_DOMESTIC,
	PRINCIPAL_ORIG_CCY,
	DISCOUNT_GIVEN_ORIG_CCY,
	OVERDRAFT_CASH_ORIG_CCY,
	PRINCIPAL_BASE_EQ,
	DISCOUNT_GIVEN_BASE_EQ,
	OVERDRAFT_CASH_BASE_EQ,
	PROD_TYPE_DESC,
	CUSTOMER_TYPE,
	UMD_1,
	SOURCE,
	UMD_2,
	UMD_3,
	UMD_4,
	TRADE_ID,
	REPORTABLE_Y_N,
	BU,
	ACCOUNT,
	PRODUCT,
	OPERATING_UNIT,
	DEPTID,
	CUST_CLASS,
	AFFILIATE,
	CIF_TYPE,
	CIF_TYPE_DESCRIPTION,
	DISC_GIVEN_CALL_CODE_CODEBLOCK,
	OVRDRFT_CASH_CALL_CODE_CODEBLK,
	FILLER_1,
	FILLER_2_ORIGINATION_DATE,
	FILLER_3_ORIGINAL_MATURITY,
	FILLER_4_CUSTOMER_NAME,
	FILLER_5_SECURED_BORROWINGS,
	FILLER_6_IBF_ONLY_COLUMN_YN,
	FILLER_7_RES_COUNTRY,
	FILLER_8_RISK_COUNTRY,
	FILLER_9,
	FILLER_10,
	FILLER_11,
	FILLER_12,
	FILLER_13,
	FILLER_14,
	FILLER_15,
	FILLER_16,
	FILLER_17,
	FILLER_18,
	FILLER_19,
	FILLER_20,
	FILLER_21,
	FILLER_22,
	FILLER_23,
	FILLER_24,
	FILLER_25,
	PROVENIENZA,
	USERUPD,
	DATEUPD
) AS 
SELECT
	RB_F_TGK_CREATE_SCENARIO_CODE(KEYS.MONTH_END_DATE) AS COD_SCENARIO,
	RB_F_TGK_CREATE_PERIOD_CODE(KEYS.MONTH_END_DATE) AS COD_PERIODO,
	RB_F_TGK_SANITIZE_CODE(DATA01.BUSINESS_UNIT) AS COD_AZIENDA,
	RB_F_TGK_SANITIZE_CODE(DATA01.AFFILIATE) AS COD_AZI_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA01.ACCOUNT) AS COD_CONTO,
	'ORI' AS COD_CATEGORIA,
	RB_F_TGK_SANITIZE_CODE(DATA01.GL_KEY_CODE) AS COD_DEST1,
	CASE
		WHEN DATA01.OPERATING_UNIT IS NOT NULL THEN 'BLC_'||RB_F_TGK_SANITIZE_CODE(DATA01.OPERATING_UNIT) 
		WHEN NULL IS NOT NULL THEN 'DPT_'||RB_F_TGK_SANITIZE_CODE(NULL) 
		ELSE RB_F_TGK_SANITIZE_CODE(NULL)
	END AS COD_DEST2,
	RB_F_TGK_SANITIZE_CODE(NULL) AS COD_DEST2_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA01.PRODUCT) AS COD_DEST3,
	RB_F_TGK_SANITIZE_CODE(DATA01.CUST_CLASS) AS COD_DEST4,
	RB_F_TGK_SANITIZE_CODE(DATA01.CALL_CODE) AS COD_DEST5,
	RB_F_TGK_SANITIZE_CODE(DATA01.CURRENCY_USQ) AS COD_VALUTA,
	RB_F_TGK_SANITIZE_CODE(DATA01.CURRENCY_CODE) AS COD_VALUTA_ORIGINARIA,
	RB_F_TGK_SANITIZE_CODE(KEYS.REPORTING_ENTITY) AS COD_REPORTING_ENTITY,
	KEYS.RB_ROWID,
	KEYS.MONTH_END_DATE,
	KEYS.REPORTING_ENTITY,
	DATA01.INSTRUMENT,
	DATA01.INTERCOMPANY,
	DATA01.CALL_CODE,
	DATA01.CALL_CODE_DESC,
	DATA01.GL_KEY_CODE,
	DATA01.GL_KEY_CODE_DESC,
	DATA01.CONSOL_NODE,
	DATA01.BUSINESS_UNIT,
	DATA01.CURRENCY_CODE,
	DATA01.FOREIGN_AMOUNT,
	DATA01.CURRENCY_USQ,
	DATA01.BASE_EQUIVALENT,
	DATA01.MATURITY_DATE,
	DATA01.REMAINING_MATURITY_DAYS,
	DATA01.MATURITY_BUCKETS,
	DATA01.MATURITY_BUCKETS_2,
	DATA01.CUSTOMER_ID,
	DATA01."DEPO_NON-DEPO",
	DATA01.FOREIGN_DOMESTIC,
	DATA01.PRINCIPAL_ORIG_CCY,
	DATA01.DISCOUNT_GIVEN_ORIG_CCY,
	DATA01.OVERDRAFT_CASH_ORIG_CCY,
	DATA01.PRINCIPAL_BASE_EQ,
	DATA01.DISCOUNT_GIVEN_BASE_EQ,
	DATA01.OVERDRAFT_CASH_BASE_EQ,
	DATA01.PROD_TYPE_DESC,
	DATA01.CUSTOMER_TYPE,
	DATA01.UMD_1,
	DATA01.SOURCE,
	DATA01.UMD_2,
	DATA01.UMD_3,
	DATA01.UMD_4,
	DATA01.TRADE_ID,
	DATA01.REPORTABLE_Y_N,
	DATA01.BU,
	DATA01.ACCOUNT,
	DATA01.PRODUCT,
	DATA01.OPERATING_UNIT,
	DATA01.DEPTID,
	DATA01.CUST_CLASS,
	DATA01.AFFILIATE,
	DATA01.CIF_TYPE,
	DATA01.CIF_TYPE_DESCRIPTION,
	DATA01.DISC_GIVEN_CALL_CODE_CODEBLOCK,
	DATA01.OVRDRFT_CASH_CALL_CODE_CODEBLK,
	DATA01.FILLER_1,
	DATA01.FILLER_2_ORIGINATION_DATE,
	DATA01.FILLER_3_ORIGINAL_MATURITY,
	DATA01.FILLER_4_CUSTOMER_NAME,
	DATA01.FILLER_5_SECURED_BORROWINGS,
	DATA01.FILLER_6_IBF_ONLY_COLUMN_YN,
	DATA01.FILLER_7_RES_COUNTRY,
	DATA01.FILLER_8_RISK_COUNTRY,
	DATA01.FILLER_9,
	DATA01.FILLER_10,
	DATA01.FILLER_11,
	DATA01.FILLER_12,
	DATA01.FILLER_13,
	DATA01.FILLER_14,
	DATA01.FILLER_15,
	DATA01.FILLER_16,
	DATA01.FILLER_17,
	DATA01.FILLER_18,
	DATA01.FILLER_19,
	DATA01.FILLER_20,
	DATA01.FILLER_21,
	DATA01.FILLER_22,
	DATA01.FILLER_23,
	DATA01.FILLER_24,
	DATA01.FILLER_25,
	DATA01.PROVENIENZA,
	DATA01.USERUPD,
	DATA01.DATEUPD
FROM
	(
		SELECT DISTINCT
		  MONTH_END_DATE,
		  REPORTING_ENTITY,
		  RB_ROWID
		FROM
		  RB_HST_BORROWINGS_01
	) KEYS
	INNER JOIN
	(
		SELECT
			RB_ROWID,
			MONTH_END_DATE,
			REPORTING_ENTITY,
			INSTRUMENT,
			INTERCOMPANY,
			CALL_CODE,
			CALL_CODE_DESC,
			GL_KEY_CODE,
			GL_KEY_CODE_DESC,
			CONSOL_NODE,
			BUSINESS_UNIT,
			CURRENCY_CODE,
			FOREIGN_AMOUNT,
			CURRENCY_USQ,
			BASE_EQUIVALENT,
			MATURITY_DATE,
			REMAINING_MATURITY_DAYS,
			MATURITY_BUCKETS,
			MATURITY_BUCKETS_2,
			CUSTOMER_ID,
			"DEPO_NON-DEPO",
			FOREIGN_DOMESTIC,
			PRINCIPAL_ORIG_CCY,
			DISCOUNT_GIVEN_ORIG_CCY,
			OVERDRAFT_CASH_ORIG_CCY,
			PRINCIPAL_BASE_EQ,
			DISCOUNT_GIVEN_BASE_EQ,
			OVERDRAFT_CASH_BASE_EQ,
			PROD_TYPE_DESC,
			CUSTOMER_TYPE,
			UMD_1,
			SOURCE,
			UMD_2,
			UMD_3,
			UMD_4,
			TRADE_ID,
			REPORTABLE_Y_N,
			BU,
			ACCOUNT,
			PRODUCT,
			OPERATING_UNIT,
			DEPTID,
			CUST_CLASS,
			AFFILIATE,
			CIF_TYPE,
			CIF_TYPE_DESCRIPTION,
			DISC_GIVEN_CALL_CODE_CODEBLOCK,
			OVRDRFT_CASH_CALL_CODE_CODEBLK,
			FILLER_1,
			FILLER_2_ORIGINATION_DATE,
      FILLER_3_ORIGINAL_MATURITY,
      FILLER_4_CUSTOMER_NAME,
      FILLER_5_SECURED_BORROWINGS,
      FILLER_6_IBF_ONLY_COLUMN_YN,
      FILLER_7_RES_COUNTRY,
      FILLER_8_RISK_COUNTRY,
			FILLER_9,
			FILLER_10,
			FILLER_11,
			FILLER_12,
			FILLER_13,
			FILLER_14,
			FILLER_15,
			FILLER_16,
			FILLER_17,
			FILLER_18,
			FILLER_19,
			FILLER_20,
			FILLER_21,
			FILLER_22,
			FILLER_23,
			FILLER_24,
			FILLER_25,
			PROVENIENZA,
			USERUPD,
			DATEUPD
		FROM
		  RB_HST_BORROWINGS_01
	) DATA01
	  ON
		KEYS.MONTH_END_DATE = DATA01.MONTH_END_DATE
		AND KEYS.REPORTING_ENTITY = DATA01.REPORTING_ENTITY
		AND KEYS.RB_ROWID = DATA01.RB_ROWID
;