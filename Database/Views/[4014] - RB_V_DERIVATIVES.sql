--------------------------------------------------------
--  DDL for View RB_V_DERIVATIVES
--------------------------------------------------------
SET DEFINE OFF;
CREATE OR REPLACE NOFORCE VIEW "RB_V_DERIVATIVES" (
	COD_SCENARIO,
	COD_PERIODO,
	COD_AZIENDA,
	COD_AZI_CTP,
	COD_CONTO,
	COD_CATEGORIA,
	COD_DEST1,
	COD_DEST2,
	COD_DEST2_CTP,
	COD_DEST3,
	COD_DEST4,
	COD_DEST5,
	COD_VALUTA,
	COD_VALUTA_ORIGINARIA,
	COD_REPORTING_ENTITY,
	RB_ROWID,
	MONTH_END_DATE,
	REPORTING_ENTITY,
	INSTRUMENT,
	INTERCOMPANY,
	CONSOL_NODE,
	BUSINESS_UNIT,
	GL_KEY_CODE,
	GL_KEY_CODE_DESC,
	CALL_CODE,
	CALL_CODE_DESC,
	ACCRUAL_VALUE,
	CLEAN_PRICE_VALUE,
	DIRTY_PRICE_VALUE,
	MANUAL_ADJUSTMENTS,
	CREDIT_ADJ,
	CREDIT_VALUATION_ADJ,
	USQ_NOTIONAL,
	POSITIVE_NEGATIVE,
	BUY_SELL_INDICATOR,
	MATURITY_PCT_WEIGHT,
	ADD_ON,
	REPLACEMENT_VALUE,
	CREDIT_EQUIVALENT,
	CPTY_WGHT,
	AMT_BOUGHT,
	AMT_SOLD,
	CCY_RECEIVE,
	CCY_PAY,
	SOURCE,
	ACC_INT_REC_GL_US_GAAP_BASE_EQ,
	UNSET_TRADE_GL_US_GAAP_BASE_EQ,
	RECEIVABLES_ADVANCES_BASE_EQ,
	UNRLZED_PLG_GL_US_GAAP_BASE_EQ,
	UNREAL_PLG_CCY_SWAP_US_BASE_EQ,
	ACC_INT_PAY_GL_US_GAAP_BASE_EQ,
	ACC_FEE_PAY_GL_US_GAAP_BASE_EQ,
	UNSET_TRADE_PAYABLE_US_BASE_EQ,
	UNRLZED_PLL_GL_US_GAAP_BASE_EQ,
	UNREAL_PLL_CCY_SWAP_US_BASE_EQ,
	MARCA_PROVISION,
	NOTL_OPT_BUY_US_GAAP_BASE_EQ,
	NOTL_SWAP_BUY_US_GAAP_BASE_EQ,
	NOTL_OPT_GL_US_GAAP_BASE_EQ,
	NOTL_OPT_SOLD_US_GAAP_BASE_EQ,
	NOTL_SWAP_SOLD_US_GAAP_BASE_EQ,
	IBF_ONLY_RAL_COLUMN_B_YN,
	REGULATORY_RISK_RATINGS,
	LEVEL_FAIR_VALUE,
	CRC_RATING,
	UMD1,
	UMD2,
	UMD3,
	MATURITY_DATE,
	REMAINING_MATURITY,
	MATURITY_BUCKETS,
	ONE_YEAR_OR_LESS,
	ONE_TO_FIVE_YEARS,
	GREATER_THAN_FIVE_YEARS,
	ACCOUNTING_CLASSIFICATION,
	BA_CODE,
	ENTITY_ENT_CODE,
	COUNTERPARTY_ENT_CODE,
	COVERED_MARKET_RISK_RULE,
	AFFIRMED_REG_RPT_CAP_GUARANTEE,
	SECURITY_DESCRIPTION,
	INVESTMENT_GRADE,
	SUBINVESTMENT_GRADE,
	UMD4,
	UMD5,
	UMD6,
	TRADE_ID,
	CUSTOMER_ID,
	RELATED_DEP_INST,
	CUSTOMER_NAME,
	CUSTOMER_TYPE,
	CITY,
	OPERATING_STATE,
	FOREIGN_DOMESTIC,
	COUNTRY_CODE,
	COUNTRY_DESC,
	RELATION_ID,
	FX_RATE_REC,
	FX_RATE_PAY,
	STRIKE_PRICE,
	FIXED_OR_VARIABLE,
	RECEIVE_INTEREST_RATE,
	PAY_INTEREST_RATE,
	INDEX_RATE_ADD,
	FLOAT_FREQ,
	LAST_RATE_RESET_DATE,
	NEXT_RATE_RESET_DATE,
	BRANCH_SUBSIDIARY,
	START_DATE,
	TRADE_DATE,
	SETTLE_DATE,
	UMD7,
	UMD8,
	UMD9,
	UMD10,
	ACCOUNT,
	PRODUCT,
	OPERATING_UNIT,
	AFFILIATE,
	CUST_CLASS,
	CODEBLOCK,
	ACCRUAL_CODEBLOCK,
	UNREALIZED_CODEBLOCK,
	CALL_CODE_CONCAT,
	FILLER_1,
	FILLER_2,
	FILLER_3,
	FILLER_4,
	FILLER_5,
	FILLER_6,
	FILLER_7,
	FILLER_8,
	FILLER_9,
	FILLER_10,
	FILLER_11,
	FILLER_12,
	FILLER_13,
	FILLER_14,
	FILLER_15,
	FILLER_16,
	FILLER_17,
	FILLER_18,
	FILLER_19,
	FILLER_20,
	FILLER_21,
	FILLER_22,
	FILLER_23,
	FILLER_24,
	FILLER_25,
	PROVENIENZA,
	USERUPD,
	DATEUPD
) AS 
SELECT
	RB_F_TGK_CREATE_SCENARIO_CODE(KEYS.MONTH_END_DATE) AS COD_SCENARIO,
	RB_F_TGK_CREATE_PERIOD_CODE(KEYS.MONTH_END_DATE) AS COD_PERIODO,
	RB_F_TGK_SANITIZE_CODE(DATA01.BUSINESS_UNIT) AS COD_AZIENDA,
	RB_F_TGK_SANITIZE_CODE(DATA01.AFFILIATE) AS COD_AZI_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA01.GL_KEY_CODE) AS COD_CONTO,
	'ORI' AS COD_CATEGORIA,
	RB_F_TGK_SANITIZE_CODE(DATA01.ACCOUNT) AS COD_DEST1,
	CASE
		WHEN DATA01.OPERATING_UNIT IS NOT NULL THEN 'BLC_'||RB_F_TGK_SANITIZE_CODE(DATA01.OPERATING_UNIT) 
		WHEN NULL IS NOT NULL THEN 'DPT_'||RB_F_TGK_SANITIZE_CODE(NULL) 
		ELSE RB_F_TGK_SANITIZE_CODE(NULL)
	END AS COD_DEST2,
	RB_F_TGK_SANITIZE_CODE(NULL) AS COD_DEST2_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA01.PRODUCT) AS COD_DEST3,
	RB_F_TGK_SANITIZE_CODE(DATA01.CUST_CLASS) AS COD_DEST4,
	RB_F_TGK_SANITIZE_CODE(DATA01.CALL_CODE) AS COD_DEST5,
	A.COD_VALUTA,
	A.COD_VALUTA AS COD_VALUTA_ORIGINARIA,
	RB_F_TGK_SANITIZE_CODE(KEYS.REPORTING_ENTITY) AS COD_REPORTING_ENTITY,
	KEYS.RB_ROWID,
	KEYS.MONTH_END_DATE,
	KEYS.REPORTING_ENTITY,
	DATA01.INSTRUMENT,
	DATA01.INTERCOMPANY,
	DATA01.CONSOL_NODE,
	DATA01.BUSINESS_UNIT,
	DATA01.GL_KEY_CODE,
	DATA01.GL_KEY_CODE_DESC,
	DATA01.CALL_CODE,
	DATA01.CALL_CODE_DESC,
	DATA01.ACCRUAL_VALUE,
	DATA01.CLEAN_PRICE_VALUE,
	DATA01.DIRTY_PRICE_VALUE,
	DATA02.MANUAL_ADJUSTMENTS,
	DATA01.CREDIT_ADJ,
	DATA01.CREDIT_VALUATION_ADJ,
	DATA01.USQ_NOTIONAL,
	DATA01.POSITIVE_NEGATIVE,
	DATA01.BUY_SELL_INDICATOR,
	DATA01.MATURITY_PCT_WEIGHT,
	DATA01.ADD_ON,
	DATA01.REPLACEMENT_VALUE,
	DATA01.CREDIT_EQUIVALENT,
	DATA01.CPTY_WGHT,
	DATA01.AMT_BOUGHT,
	DATA01.AMT_SOLD,
	DATA01.CCY_RECEIVE,
	DATA01.CCY_PAY,
	DATA01.SOURCE,
	DATA01.ACC_INT_REC_GL_US_GAAP_BASE_EQ,
	DATA01.UNSET_TRADE_GL_US_GAAP_BASE_EQ,
	DATA01.RECEIVABLES_ADVANCES_BASE_EQ,
	DATA01.UNRLZED_PLG_GL_US_GAAP_BASE_EQ,
	DATA01.UNREAL_PLG_CCY_SWAP_US_BASE_EQ,
	DATA01.ACC_INT_PAY_GL_US_GAAP_BASE_EQ,
	DATA01.ACC_FEE_PAY_GL_US_GAAP_BASE_EQ,
	DATA01.UNSET_TRADE_PAYABLE_US_BASE_EQ,
	DATA01.UNRLZED_PLL_GL_US_GAAP_BASE_EQ,
	DATA01.UNREAL_PLL_CCY_SWAP_US_BASE_EQ,
	DATA01.MARCA_PROVISION,
	DATA01.NOTL_OPT_BUY_US_GAAP_BASE_EQ,
	DATA01.NOTL_SWAP_BUY_US_GAAP_BASE_EQ,
	DATA01.NOTL_OPT_GL_US_GAAP_BASE_EQ,
	DATA01.NOTL_OPT_SOLD_US_GAAP_BASE_EQ,
	DATA01.NOTL_SWAP_SOLD_US_GAAP_BASE_EQ,
	DATA01.IBF_ONLY_RAL_COLUMN_B_YN,
	DATA01.REGULATORY_RISK_RATINGS,
	DATA01.LEVEL_FAIR_VALUE,
	DATA01.CRC_RATING,
	DATA01.UMD1,
	DATA01.UMD2,
	DATA01.UMD3,
	DATA01.MATURITY_DATE,
	DATA01.REMAINING_MATURITY,
	DATA01.MATURITY_BUCKETS,
	DATA01.ONE_YEAR_OR_LESS,
	DATA01.ONE_TO_FIVE_YEARS,
	DATA01.GREATER_THAN_FIVE_YEARS,
	DATA01.ACCOUNTING_CLASSIFICATION,
	DATA01.BA_CODE,
	DATA01.ENTITY_ENT_CODE,
	DATA01.COUNTERPARTY_ENT_CODE,
	DATA01.COVERED_MARKET_RISK_RULE,
	DATA01.AFFIRMED_REG_RPT_CAP_GUARANTEE,
	DATA01.SECURITY_DESCRIPTION,
	DATA01.INVESTMENT_GRADE,
	DATA01.SUBINVESTMENT_GRADE,
	DATA01.UMD4,
	DATA01.UMD5,
	DATA01.UMD6,
	DATA01.TRADE_ID,
	DATA01.CUSTOMER_ID,
	DATA01.RELATED_DEP_INST,
	DATA01.CUSTOMER_NAME,
	DATA01.CUSTOMER_TYPE,
	DATA01.CITY,
	DATA01.OPERATING_STATE,
	DATA01.FOREIGN_DOMESTIC,
	DATA01.COUNTRY_CODE,
	DATA01.COUNTRY_DESC,
	DATA01.RELATION_ID,
	DATA01.FX_RATE_REC,
	DATA01.FX_RATE_PAY,
	DATA01.STRIKE_PRICE,
	DATA01.FIXED_OR_VARIABLE,
	DATA01.RECEIVE_INTEREST_RATE,
	DATA01.PAY_INTEREST_RATE,
	DATA01.INDEX_RATE_ADD,
	DATA01.FLOAT_FREQ,
	DATA01.LAST_RATE_RESET_DATE,
	DATA01.NEXT_RATE_RESET_DATE,
	DATA01.BRANCH_SUBSIDIARY,
	DATA01.START_DATE,
	DATA01.TRADE_DATE,
	DATA01.SETTLE_DATE,
	DATA01.UMD7,
	DATA01.UMD8,
	DATA01.UMD9,
	DATA01.UMD10,
	DATA01.ACCOUNT,
	DATA01.PRODUCT,
	DATA01.OPERATING_UNIT,
	DATA01.AFFILIATE,
	DATA01.CUST_CLASS,
	DATA01.CODEBLOCK,
	DATA01.ACCRUAL_CODEBLOCK,
	DATA01.UNREALIZED_CODEBLOCK,
	DATA01.CALL_CODE_CONCAT,
	DATA01.FILLER_1,
	DATA01.FILLER_2,
	DATA01.FILLER_3,
	DATA01.FILLER_4,
	DATA01.FILLER_5,
	DATA01.FILLER_6,
	DATA01.FILLER_7,
	DATA01.FILLER_8,
	DATA01.FILLER_9,
	DATA01.FILLER_10,
	DATA01.FILLER_11,
	DATA01.FILLER_12,
	DATA01.FILLER_13,
	DATA01.FILLER_14,
	DATA01.FILLER_15,
	DATA01.FILLER_16,
	DATA01.FILLER_17,
	DATA01.FILLER_18,
	DATA01.FILLER_19,
	DATA02.FILLER_20,
	DATA02.FILLER_21,
	DATA02.FILLER_22,
	DATA02.FILLER_23,
	DATA02.FILLER_24,
	DATA02.FILLER_25,
	DATA01.PROVENIENZA,
	DATA01.USERUPD,
	DATA01.DATEUPD
FROM
	(
		SELECT DISTINCT
		  MONTH_END_DATE,
		  REPORTING_ENTITY,
		  RB_ROWID
		FROM
		  RB_HST_DERIVATIVES_01
	) KEYS
	INNER JOIN
	(
		SELECT
			RB_ROWID,
			MONTH_END_DATE,
			REPORTING_ENTITY,
			INSTRUMENT,
			INTERCOMPANY,
			CONSOL_NODE,
			BUSINESS_UNIT,
			GL_KEY_CODE,
			GL_KEY_CODE_DESC,
			CALL_CODE,
			CALL_CODE_DESC,
			ACCRUAL_VALUE,
			CLEAN_PRICE_VALUE,
			DIRTY_PRICE_VALUE,
			CREDIT_ADJ,
			CREDIT_VALUE_ADJ,
			USQ_NOTIONAL,
			POSITIVE_NEGATIVE,
			BUY_SELL_INDICATOR,
			MATURITY_PCT_WEIGHT,
			ADD_ON,
			REPLACEMENT_VALUE,
			CREDIT_EQUIVALENT,
			CPTY_WGHT,
			AMT_BOUGHT,
			AMT_SOLD,
			CCY_RECEIVE,
			CCY_PAY,
			SOURCE,
			ACC_INT_REC_GL_US_GAAP_BASE_EQ,
			UNSET_TRADE_GL_US_GAAP_BASE_EQ,
			RECEIVABLES_ADVANCES_BASE_EQ,
			UNRLZED_PLG_GL_US_GAAP_BASE_EQ,
			UNREAL_PLG_CCY_SWAP_US_BASE_EQ,
			ACC_INT_PAY_GL_US_GAAP_BASE_EQ,
			ACC_FEE_PAY_GL_US_GAAP_BASE_EQ,
			UNSET_TRADE_PAYABLE_US_BASE_EQ,
			UNRLZED_PLL_GL_US_GAAP_BASE_EQ,
			UNREAL_PLL_CCY_SWAP_US_BASE_EQ,
			MARCA_PROVISION,
			NOTL_OPT_BUY_US_GAAP_BASE_EQ,
			NOTL_SWAP_BUY_US_GAAP_BASE_EQ,
			NOTL_OPT_GL_US_GAAP_BASE_EQ,
			NOTL_OPT_SOLD_US_GAAP_BASE_EQ,
			NOTL_SWAP_SOLD_US_GAAP_BASE_EQ,
			IBF_ONLY_RAL_COLUMN_B_YN,
			REGULATORY_RISK_RATINGS,
			LEVEL_FAIR_VALUE,
			CRC_RATING,
			UMD1,
			UMD2,
			UMD3,
			MATURITY_DATE,
			REMAINING_MATURITY,
			MATURITY_BUCKETS,
			ONE_YEAR_OR_LESS,
			ONE_TO_FIVE_YEARS,
			GREATER_THAN_FIVE_YEARS,
			ACCOUNTING_CLASSIFICATION,
			BA_CODE,
			ENTITY_ENT_CODE,
			COUNTERPARTY_ENT_CODE,
			COVERED_MARKET_RISK_RULE,
			AFFIRMED_REG_RPT_CAP_GUARANTEE,
			SECURITY_DESCRIPTION,
			INVESTMENT_GRADE,
			SUBINVESTMENT_GRADE,
			UMD4,
			UMD5,
			UMD6,
			TRADE_ID,
			CUSTOMER_ID,
			RELATED_DEP_INST,
			CUSTOMER_NAME,
			CUSTOMER_TYPE,
			CITY,
			OPERATING_STATE,
			FOREIGN_DOMESTIC,
			COUNTRY_CODE,
			COUNTRY_DESC,
			RELATION_ID,
			FX_RATE_REC,
			FX_RATE_PAY,
			STRIKE_PRICE,
			FIXED_OR_VARIABLE,
			RECEIVE_INTEREST_RATE,
			PAY_INTEREST_RATE,
			INDEX_RATE_ADD,
			FLOAT_FREQ,
			LAST_RATE_RESET_DATE,
			NEXT_RATE_RESET_DATE,
			BRANCH_SUBSIDIARY,
			START_DATE,
			TRADE_DATE,
			SETTLE_DATE,
			UMD7,
			UMD8,
			UMD9,
			UMD10,
			ACCOUNT,
			PRODUCT,
			OPERATING_UNIT,
			AFFILIATE,
			CUST_CLASS,
			CODEBLOCK,
			ACCRUAL_CODEBLOCK,
			UNREALIZED_CODEBLOCK,
			CALL_CODE_CONCAT,
			FILLER_1,
			FILLER_2,
			FILLER_3,
			FILLER_4,
			FILLER_5,
			FILLER_6,
			FILLER_7,
			FILLER_8,
			FILLER_9,
			FILLER_10,
			FILLER_11,
			FILLER_12,
			FILLER_13,
			FILLER_14,
			FILLER_15,
			FILLER_16,
			FILLER_17,
			FILLER_18,
			FILLER_19,
			PROVENIENZA,
			USERUPD,
			DATEUPD
		FROM
		  RB_HST_DERIVATIVES_01
	) DATA01
	  ON
		KEYS.MONTH_END_DATE = DATA01.MONTH_END_DATE
		AND KEYS.REPORTING_ENTITY = DATA01.REPORTING_ENTITY
		AND KEYS.RB_ROWID = DATA01.RB_ROWID
	INNER JOIN
	(
		SELECT
			RB_ROWID,
			MONTH_END_DATE,
			REPORTING_ENTITY,
			MANUAL_ADJUSTMENTS,
			FILLER_20,
			FILLER_21,
			FILLER_22,
			FILLER_23,
			FILLER_24,
			FILLER_25,
			PROVENIENZA,
			USERUPD,
			DATEUPD
		FROM
		  RB_HST_DERIVATIVES_02
	) DATA02
	ON
		KEYS.MONTH_END_DATE = DATA02.MONTH_END_DATE
		AND KEYS.REPORTING_ENTITY = DATA02.REPORTING_ENTITY
		AND KEYS.RB_ROWID = DATA02.RB_ROWID
	LEFT OUTER JOIN
	AZIENDA A
	ON
		DATA01.BUSINESS_UNIT = A.COD_AZIENDA
;