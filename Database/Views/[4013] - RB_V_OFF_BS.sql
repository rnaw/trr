--------------------------------------------------------
--  DDL for View RB_V_OFF_BS
--------------------------------------------------------
SET DEFINE OFF;
CREATE OR REPLACE NOFORCE VIEW "RB_V_OFF_BS" (
	COD_SCENARIO,
	COD_PERIODO,
	COD_AZIENDA,
	COD_AZI_CTP,
	COD_CONTO,
	COD_CATEGORIA,
	COD_DEST1,
	COD_DEST2,
	COD_DEST2_CTP,
	COD_DEST3,
	COD_DEST4,
	COD_DEST5,
	COD_VALUTA,
	COD_VALUTA_ORIGINARIA,
	COD_REPORTING_ENTITY,
	RB_ROWID,
	MONTH_END_DATE,
	REPORTING_ENTITY,
	INSTRUMENT,
	CALL_CODE,
	CALL_CODE_DESC,
	GL_KEY_CODE,
	GL_KEY_CODE_DESC,
	CONSOL_NODE,
	BUSINESS_UNIT,
	CURRENCY_CODE,
	FOREIGN_AMOUNT,
	CURRENCY_USQ,
	BASE_EQUIVALENT,
	ORIGINATION_DATE,
	MATURITY_DATE,
	REMAINING_MATURITY_DAYS,
	FRONTED_UNFUNDED_PARTICIPANTS,
	CUSTOMER_ID,
	CUSTOMER_NAME,
	"DEPO_NON-DEPO",
	FOREIGN_DOMESTIC,
	CANCELLABLE_Y_N,
	MATURITY_BUCKETS,
	SECURITIZATION_EXPO,
	CREDIT_CONVERSION_FACTOR,
	CREDIT_EQUIVALENT_AMT,
	RISK_COUNTRY,
	RISK_COUNTRY_CODE,
	RISK_WEIGHTED_CATEGORY,
	RISK_WEIGHTED_ALLOCATION,
	UMD_1,
	UMD_2,
	UMD_3,
	SECURED_Y_N,
	GUARANTEED_Y_N,
	GOVT_GUARANTEED_PERCENTAGE ,
	QUALIFIED_CENTRAL_CPT_Y_N,
	ABCP_CONDUITS_AMT,
	SOVERIGN_DEFAULT_Y_N,
	CRC_RATING_OF_OECD_EXPOSURES,
	US_GAAP_RISK_RATING,
	IFRS_RISK_RATING,
	FACILITY_LIMIT_AMOUNT,
	FACILITY_USED_AMOUNT,
	SYNDICATED_RABOSHARE,
	"SYNDICATED_RABOSHARE_%",
	SYNDICATED_PARTICIPANTS,
	"SYNDICATED_PARTICIPANTS_%",
	SOURCE,
	UMD_4,
	UMD_5,
	UMD_6,
	TRADE_ID,
	REPORTABLE_Y_N,
	BU,
	ACCOUNT,
	PRODUCT,
	OPERATING_UNIT,
	DEPTID,
	CUST_CLASS,
	AFFILIATE,
	CIF_TYPE,
	CUSTOMER_TYPE,
	LOAN_CALL_CODE,
	PRODUCT_GROUP,
	FACILITY_TYPE,
	FACILITY_TYPE_DESC,
	CALL_CODE_CODEBLOCK,
	CCF_CODEBLOCK,
	FILLER_1,
	FILLER_2,
	FILLER_3,
	FILLER_4,
	FILLER_5,
	FILLER_6,
	FILLER_7,
	FILLER_8,
	FILLER_9,
	FILLER_10,
	FILLER_11,
	FILLER_12,
	FILLER_13,
	FILLER_14,
	FILLER_15,
	FILLER_16,
	FILLER_17,
	FILLER_18,
	FILLER_19,
	FILLER_20,
	FILLER_21,
	FILLER_22,
	FILLER_23,
	FILLER_24,
	FILLER_25,
	PROVENIENZA,
	USERUPD,
	DATEUPD
) AS 
SELECT
	RB_F_TGK_CREATE_SCENARIO_CODE(DATA.MONTH_END_DATE) AS COD_SCENARIO,
	RB_F_TGK_CREATE_PERIOD_CODE(DATA.MONTH_END_DATE) AS COD_PERIODO,
	RB_F_TGK_SANITIZE_CODE(DATA.BUSINESS_UNIT) AS COD_AZIENDA,
	RB_F_TGK_SANITIZE_CODE(DATA.AFFILIATE) AS COD_AZI_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA.ACCOUNT) AS COD_CONTO,
	'ORI' AS COD_CATEGORIA,
	RB_F_TGK_SANITIZE_CODE(DATA.GL_KEY_CODE) AS COD_DEST1,
	CASE
		WHEN DATA.OPERATING_UNIT IS NOT NULL THEN 'BLC_'||RB_F_TGK_SANITIZE_CODE(DATA.OPERATING_UNIT) 
		WHEN NULL IS NOT NULL THEN 'DPT_'||RB_F_TGK_SANITIZE_CODE(NULL) 
		ELSE RB_F_TGK_SANITIZE_CODE(NULL)
	END AS COD_DEST2,
	RB_F_TGK_SANITIZE_CODE(NULL) AS COD_DEST2_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA.PRODUCT) AS COD_DEST3,
	RB_F_TGK_SANITIZE_CODE(DATA.CUST_CLASS) AS COD_DEST4,
	RB_F_TGK_SANITIZE_CODE(DATA.CALL_CODE) AS COD_DEST5,
	A.COD_VALUTA,
	DATA.CURRENCY_CODE AS COD_VALUTA_ORIGINARIA,
	RB_F_TGK_SANITIZE_CODE(DATA.REPORTING_ENTITY) AS COD_REPORTING_ENTITY,
	DATA.RB_ROWID,
	DATA.MONTH_END_DATE,
	DATA.REPORTING_ENTITY,
	DATA.INSTRUMENT,
	DATA.CALL_CODE,
	DATA.CALL_CODE_DESC,
	DATA.GL_KEY_CODE,
	DATA.GL_KEY_CODE_DESC,
	DATA.CONSOL_NODE,
	DATA.BUSINESS_UNIT,
	DATA.CURRENCY_CODE,
	DATA.FOREIGN_AMOUNT,
	DATA.CURRENCY_USQ,
	DATA.BASE_EQUIVALENT,
	DATA.ORIGINATION_DATE,
	DATA.MATURITY_DATE,
	DATA.REMAINING_MATURITY_DAYS,
	DATA.FRONTED_UNFUNDED_PARTICIPANTS,
	DATA.CUSTOMER_ID,
	DATA.CUSTOMER_NAME,
	DATA."DEPO_NON-DEPO",
	DATA.FOREIGN_DOMESTIC,
	DATA.CANCELLABLE_Y_N,
	DATA.MATURITY_BUCKETS,
	DATA.SECURITIZATION_EXPO,
	DATA.CREDIT_CONVERSION_FACTOR,
	DATA.CREDIT_EQUIVALENT_AMT,
	DATA.RISK_COUNTRY,
	DATA.RISK_COUNTRY_CODE,
	DATA.RISK_WEIGHTED_CATEGORY,
	DATA.RISK_WEIGHTED_ALLOCATION,
	DATA.UMD_1,
	DATA.UMD_2,
	DATA.UMD_3,
	DATA.SECURED_Y_N,
	DATA.GUARANTEED_Y_N,
	DATA.GOVT_GUARANTEED_PERCENTAGE ,
	DATA.QUALIFIED_CENTRAL_CPT_Y_N,
	DATA.ABCP_CONDUITS_AMT,
	DATA.SOVERIGN_DEFAULT_Y_N,
	DATA.CRC_RATING_OF_OECD_EXPOSURES,
	DATA.US_GAAP_RISK_RATING,
	DATA.IFRS_RISK_RATING,
	DATA.FACILITY_LIMIT_AMOUNT,
	DATA.FACILITY_USED_AMOUNT,
	DATA.SYNDICATED_RABOSHARE,
	DATA."SYNDICATED_RABOSHARE_%",
	DATA.SYNDICATED_PARTICIPANTS,
	DATA."SYNDICATED_PARTICIPANTS_%",
	DATA.SOURCE,
	DATA.UMD_4,
	DATA.UMD_5,
	DATA.UMD_6,
	DATA.TRADE_ID,
	DATA.REPORTABLE_Y_N,
	DATA.BU,
	DATA.ACCOUNT,
	DATA.PRODUCT,
	DATA.OPERATING_UNIT,
	DATA.DEPTID,
	DATA.CUST_CLASS,
	DATA.AFFILIATE,
	DATA.CIF_TYPE,
	DATA.CUSTOMER_TYPE,
	DATA.LOAN_CALL_CODE,
	DATA.PRODUCT_GROUP,
	DATA.FACILITY_TYPE,
	DATA.FACILITY_TYPE_DESC,
	DATA.CALL_CODE_CODEBLOCK,
	DATA.CCF_CODEBLOCK,
	DATA.FILLER_1,
	DATA.FILLER_2,
	DATA.FILLER_3,
	DATA.FILLER_4,
	DATA.FILLER_5,
	DATA.FILLER_6,
	DATA.FILLER_7,
	DATA.FILLER_8,
	DATA.FILLER_9,
	DATA.FILLER_10,
	DATA.FILLER_11,
	DATA.FILLER_12,
	DATA.FILLER_13,
	DATA.FILLER_14,
	DATA.FILLER_15,
	DATA.FILLER_16,
	DATA.FILLER_17,
	DATA.FILLER_18,
	DATA.FILLER_19,
	DATA.FILLER_20,
	DATA.FILLER_21,
	DATA.FILLER_22,
	DATA.FILLER_23,
	DATA.FILLER_24,
	DATA.FILLER_25,
	DATA.PROVENIENZA,
	DATA.USERUPD,
	DATA.DATEUPD
FROM
	RB_HST_OFF_BS_01 DATA
	LEFT OUTER JOIN
	AZIENDA A
	ON
		DATA.BUSINESS_UNIT = A.COD_AZIENDA
;