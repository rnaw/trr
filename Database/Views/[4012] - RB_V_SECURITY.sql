--------------------------------------------------------
--  DDL for View RB_V_SECURITY
--------------------------------------------------------
SET DEFINE OFF;
CREATE OR REPLACE NOFORCE VIEW "RB_V_SECURITY" (
	COD_SCENARIO,
	COD_PERIODO,
	COD_AZIENDA,
	COD_AZI_CTP,
	COD_CONTO,
	COD_CATEGORIA,
	COD_DEST1,
	COD_DEST2,
	COD_DEST2_CTP,
	COD_DEST3,
	COD_DEST4,
	COD_DEST5,
	COD_VALUTA,
	COD_VALUTA_ORIGINARIA,
	COD_REPORTING_ENTITY,
	RB_ROWID,
	MONTH_END_DATE,
	REPORTING_ENTITY,
	INSTRUMENT,
	INTERCOMPANY,
	CONSOL_NODE,
	BUSINESS_UNIT,
	GL_KEY_CODE,
	GL_KEY_CODE_DESC,
	CALL_CODE,
	CALL_CODE_DESC,
	PRODUCT_GROUP_DESC,
	AMORTIZED_COST,
	FAIR_VALUE,
	PRICE,
	PRINCIPAL_GL_US_GAAP_BASE_EQ,
	DISCOUNT_GL_US_GAAP_BASE_EQ,
	PREMIUM_GL_US_GAAP_BASE_EQ,
	UNRLZED_PL_GL_US_GAAP_BASE_EQ,
	LTD_IMPAIRMENT_US_GAAP_BASE_EQ,
	SOURCE,
	IBF_ONLY_RAL_COLUMN_B_YN,
	CURRENCY_CODE,
	REGULATORY_RISK_RATINGS,
	LEVEL_FAIR_VALUE,
	ORIGINAL_PRICE,
	MATURITY_DATE,
	REMAINING_MATURITY,
	INT_RATE,
	FIXED_OR_VARIABLE,
	FLOATING_RATE,
	FIXED_RATE,
	INDEX_RATE_ADD,
	FLOAT_FREQ,
	MATURITY_BUCKETS,
	LAST_RATE_RESET_DATE,
	NEXT_RATE_RESET_DATE,
	DAY_COUNT_BASIS,
	PLEDGED_SECURITIES_YN,
	CMMP_TO_PURCHASE_SEC_YN,
	GUARANTOR,
	CUSTOMER_NAME,
	CUSTOMER_TYPE,
	CITY,
	OPERATING_STATE,
	COUNTRY_CODE,
	COUNTRY_DESC,
	FOREIGN_DOMESTIC,
	SECURITY_DESCRIPTION,
	"S&P_RATING",
	MOODYS_RATING,
	CUSIP,
	ISIN,
	TRADE_ID,
	CUSTOMER_ID,
	RELATED_DEP_INST,
	BRANCH_SUBSIDIARY,
	VAL_DATE,
	TRADE_DATE,
	SETTLE_DATE,
	LAST_PRIN_PMT,
	UMD1,
	UMD2,
	UMD3,
	UMD4,
	UMD5,
	UMD6,
	UMD7,
	UMD8,
	UMD9,
	UMD10,
	SYMB_POOL,
	PORTFOLIO,
	ACCOUNT_CAMRA,
	PRODUCT_CAMRA,
	ACCOUNT,
	PRODUCT,
	OPERATING_UNIT,
	AFFILIATE,
	CUST_CLASS,
	DISCOUNT_CODEBLOCK,
	PREMIUM_CODEBLOCK,
	UNRLZED_CODEBLOCK,
	LTD_IMPAIRMENT_CODEBLOCK,
	FILLER_1,
	FILLER_2,
	FILLER_3,
	FILLER_4,
	FILLER_5,
	FILLER_6,
	FILLER_7,
	FILLER_8,
	FILLER_9,
	FILLER_10,
	FILLER_11,
	FILLER_12,
	FILLER_13,
	FILLER_14,
	FILLER_15,
	FILLER_16,
	FILLER_17,
	FILLER_18,
	FILLER_19,
	FILLER_20,
	FILLER_21,
	FILLER_22,
	FILLER_23,
	FILLER_24,
	FILLER_25,
	PROVENIENZA,
	USERUPD,
	DATEUPD
) AS 
SELECT
	RB_F_TGK_CREATE_SCENARIO_CODE(DATA.MONTH_END_DATE) AS COD_SCENARIO,
	RB_F_TGK_CREATE_PERIOD_CODE(DATA.MONTH_END_DATE) AS COD_PERIODO,
	RB_F_TGK_SANITIZE_CODE(DATA.BUSINESS_UNIT) AS COD_AZIENDA,
	RB_F_TGK_SANITIZE_CODE(DATA.AFFILIATE) AS COD_AZI_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA.GL_KEY_CODE) AS COD_CONTO,
	'ORI' AS COD_CATEGORIA,
	RB_F_TGK_SANITIZE_CODE(DATA.ACCOUNT) AS COD_DEST1,
	CASE
		WHEN DATA.OPERATING_UNIT IS NOT NULL THEN 'BLC_'||RB_F_TGK_SANITIZE_CODE(DATA.OPERATING_UNIT) 
		WHEN NULL IS NOT NULL THEN 'DPT_'||RB_F_TGK_SANITIZE_CODE(NULL) 
		ELSE RB_F_TGK_SANITIZE_CODE(NULL)
	END AS COD_DEST2,
	RB_F_TGK_SANITIZE_CODE(NULL) AS COD_DEST2_CTP,
	RB_F_TGK_SANITIZE_CODE(DATA.PRODUCT) AS COD_DEST3,
	RB_F_TGK_SANITIZE_CODE(DATA.CUST_CLASS) AS COD_DEST4,
	RB_F_TGK_SANITIZE_CODE(DATA.CALL_CODE) AS COD_DEST5,
	A.COD_VALUTA,
	DATA.CURRENCY_CODE AS COD_VALUTA_ORIGINARIA,
	RB_F_TGK_SANITIZE_CODE(DATA.REPORTING_ENTITY) AS COD_REPORTING_ENTITY,
	DATA.RB_ROWID,
	DATA.MONTH_END_DATE,
	DATA.REPORTING_ENTITY,
	DATA.INSTRUMENT,
	DATA.INTERCOMPANY,
	DATA.CONSOL_NODE,
	DATA.BUSINESS_UNIT,
	DATA.GL_KEY_CODE,
	DATA.GL_KEY_CODE_DESC,
	DATA.CALL_CODE,
	DATA.CALL_CODE_DESC,
	DATA.PRODUCT_GROUP_DESC,
	DATA.AMORTIZED_COST,
	DATA.FAIR_VALUE,
	DATA.PRICE,
	DATA.PRINCIPAL_GL_US_GAAP_BASE_EQ,
	DATA.DISCOUNT_GL_US_GAAP_BASE_EQ,
	DATA.PREMIUM_GL_US_GAAP_BASE_EQ,
	DATA.UNRLZED_PL_GL_US_GAAP_BASE_EQ,
	DATA.LTD_IMPAIRMENT_US_GAAP_BASE_EQ,
	DATA.SOURCE,
	DATA.IBF_ONLY_RAL_COLUMN_B_YN,
	DATA.CURRENCY_CODE,
	DATA.REGULATORY_RISK_RATINGS,
	DATA.LEVEL_FAIR_VALUE,
	DATA.ORIGINAL_PRICE,
	DATA.MATURITY_DATE,
	DATA.REMAINING_MATURITY,
	DATA.INT_RATE,
	DATA.FIXED_OR_VARIABLE,
	DATA.FLOATING_RATE,
	DATA.FIXED_RATE,
	DATA.INDEX_RATE_ADD,
	DATA.FLOAT_FREQ,
	DATA.MATURITY_BUCKETS,
	DATA.LAST_RATE_RESET_DATE,
	DATA.NEXT_RATE_RESET_DATE,
	DATA.DAY_COUNT_BASIS,
	DATA.PLEDGED_SECURITIES_YN,
	DATA.CMMP_TO_PURCHASE_SEC_YN,
	DATA.GUARANTOR,
	DATA.CUSTOMER_NAME,
	DATA.CUSTOMER_TYPE,
	DATA.CITY,
	DATA.OPERATING_STATE,
	DATA.COUNTRY_CODE,
	DATA.COUNTRY_DESC,
	DATA.FOREIGN_DOMESTIC,
	DATA.SECURITY_DESCRIPTION,
	DATA."S&P_RATING",
	DATA.MOODYS_RATING,
	DATA.CUSIP,
	DATA.ISIN,
	DATA.TRADE_ID,
	DATA.CUSTOMER_ID,
	DATA.RELATED_DEP_INST,
	DATA.BRANCH_SUBSIDIARY,
	DATA.VAL_DATE,
	DATA.TRADE_DATE,
	DATA.SETTLE_DATE,
	DATA.LAST_PRIN_PMT,
	DATA.UMD1,
	DATA.UMD2,
	DATA.UMD3,
	DATA.UMD4,
	DATA.UMD5,
	DATA.UMD6,
	DATA.UMD7,
	DATA.UMD8,
	DATA.UMD9,
	DATA.UMD10,
	DATA.SYMB_POOL,
	DATA.PORTFOLIO,
	DATA.ACCOUNT_CAMRA,
	DATA.PRODUCT_CAMRA,
	DATA.ACCOUNT,
	DATA.PRODUCT,
	DATA.OPERATING_UNIT,
	DATA.AFFILIATE,
	DATA.CUST_CLASS,
	DATA.DISCOUNT_CODEBLOCK,
	DATA.PREMIUM_CODEBLOCK,
	DATA.UNRLZED_CODEBLOCK,
	DATA.LTD_IMPAIRMENT_CODEBLOCK,
	DATA.FILLER_1,
	DATA.FILLER_2,
	DATA.FILLER_3,
	DATA.FILLER_4,
	DATA.FILLER_5,
	DATA.FILLER_6,
	DATA.FILLER_7,
	DATA.FILLER_8,
	DATA.FILLER_9,
	DATA.FILLER_10,
	DATA.FILLER_11,
	DATA.FILLER_12,
	DATA.FILLER_13,
	DATA.FILLER_14,
	DATA.FILLER_15,
	DATA.FILLER_16,
	DATA.FILLER_17,
	DATA.FILLER_18,
	DATA.FILLER_19,
	DATA.FILLER_20,
	DATA.FILLER_21,
	DATA.FILLER_22,
	DATA.FILLER_23,
	DATA.FILLER_24,
	DATA.FILLER_25,
	DATA.PROVENIENZA,
	DATA.USERUPD,
	DATA.DATEUPD
FROM
	RB_HST_SECURITY DATA
	LEFT OUTER JOIN
	AZIENDA A
	ON
		DATA.BUSINESS_UNIT = A.COD_AZIENDA
;