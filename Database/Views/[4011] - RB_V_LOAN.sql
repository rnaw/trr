--------------------------------------------------------
--  DDL for View RB_V_LOAN
--------------------------------------------------------

  CREATE OR REPLACE FORCE VIEW "RB_V_LOAN" (
    "COD_SCENARIO",
    "COD_PERIODO",
    "COD_AZIENDA",
    "COD_AZI_CTP",
    "COD_CONTO",
    "COD_CATEGORIA",
    "COD_DEST1",
    "COD_DEST2",
    "COD_DEST2_CTP",
    "COD_DEST3",
    "COD_DEST4",
    "COD_DEST5",
    "COD_VALUTA",
    "COD_VALUTA_ORIGINARIA",
    "RB_ROWID",
    "MONTH_END_DATE",
    "REPORTING_ENTITY",
    "COD_REPORTING_ENTITY",
    "INSTRUMENT",
    "INTERCOMPANY",
    "CALL_CODE",
    "CALL_CODE_DESC",
    "BASE_EQUIVALENT",
    "PROD_GROUP_DESC",
    "PROD_GROUP_TYPE_DESC",
    "CUSTOMER_ID",
    "CUSTOMER_NAME",
    "CUSTOMER_TYPE",
    "RELATED_DEP_INST_YESNO",
    "PURPOSE_CODE",
    "FOREIGN_DOMESTIC",
    "CUST_PARENT_FOREIGN_DOMESTIC",
    "COUNTRY_CODE",
    "COUNTRY_DESC",
    "RISK_COUNTRY",
    "OPERATING_STATE",
    "LOAN_USED_IN_STATE",
    "BORROWER_COUNTY",
    "LOAN_USED_IN_COUNTY",
    "AFFL_CONSOL_NODE",
    "DAY_COUNT_BASIS",
    "SOURCE",
    "HIGHLVL_PROD_CAT",
    "GL_KEY_CODE",
    "GL_KEY_CODE_DESC",
    "PRINCIPAL_GL_US_GAAP_BASE_EQ",
    "ACC_INT_GL_US_GAAP_BASE_EQ",
    "DEF_FEES_GL_US_GAAP_BASE_EQ",
    "UNEARN_FEES_GL_US_GAAP_BASE_EQ",
    "SPCFC_RESRV_GL_US_GAAP_BASE_EQ",
    "INT_INC_GL_US_GAAP_BASE_EQ",
    "FEES_GL_US_GAAP_BASE_EQ",
    "PRINCIPAL_GL_IFRS_BASE_EQ",
    "ACC_INT_GL_IFRS_BASE_EQ",
    "DEFERRED_FEES_GL_IFRS_BASE_EQ",
    "UNEARNED_FEES_GL_IFRS_BASE_EQ",
    "SPCFC_RESRV_GL_IFRS_BASE_EQ",
    "INT_INC_GL_IFRS_BASE_EQ",
    "FEES_GL_IFRS_BASE_EQ",
    "UMD1",
    "UMD2",
    "UMD3",
    "CONSOL_NODE",
    "SUB_LE1",
    "SUB_LE2",
    "BUSINESS_UNIT",
    "BUSINESS_LINE",
    "CURRENCY_CODE",
    "LEGAL_CUST_TOTAL_COMMIT",
    "LEGAL_CUST_PRINC_FUNDED",
    "LEGAL_CUST_UNFUNDED_COMMIT",
    "LEGAL_CUST_INT_OWED",
    "BANK_SHARE_PRINC_IFRS",
    "BANK_SHARE_PRINC_US_GAAP",
    "BANK_SHARE_TOTAL_COMMIT",
    "BANK_SHARE_UNFUNDED_COMMIT",
    "BANK_SPECIFIC_RESRV_US_GAAP",
    "UNEARNED_FEES_US_GAAP",
    "CHARGED_OFF_US_GAAP",
    "CHARGED_OFF_IFRS",
    "SPECIFIC_RESRV_IFRS",
    "NON_ACC_INTEREST_DIFF_US_GAAP",
    "INTEREST_APPLIED_PRINC_US_GAAP",
    "NON_ACC_INTEREST_DIFF_IFRS",
    "INTEREST_APPLLIED_PRINC_IFRS",
    "UNEARNED_FEE_IFRS",
    "LEDGER_ACCRUED_INTEREST_IFRS",
    "LEDG_ACC_INTEREST_US_GAAP",
    "INTEREST_PL_MTD_IFRS",
    "INTEREST_PL_MTD_US_GAAP",
    "INTEREST_PL_QTD_IFRS",
    "INTEREST_PL_QTD_US_GAAP",
    "INTEREST_PL_YTD_IFRS",
    "INTEREST_PL_YTD_US_GAAP",
    "ORIGINAL_PREMIUM_DISCOUNT",
    "REMAINING_PREMIUM_DISCOUNT",
    "ORIGINATION_DATE",
    "MATURITY_DATE",
    "ORIGINAL_INTEREST_RATE",
    "REVOLVER_YN",
    "RATE_EFFECTIVE_DATE",
    "RATE_EXPIRATION_DATE",
    "INTEREST_RATE",
    "OVER_UNDER_RATE_INDEX",
    "NOTE_CEILING_RATE",
    "NOTE_FLOOR_RATE",
    "NEXT_RATE_RESET_DATE",
    "LAST_RATE_RESET_DATE",
    "RATE_RESET_FREQUENCY",
    "LAST_REPRICING_DATE",
    "RB_INDEX",
    "FIXED_OR_VARIABLE",
    "BOOK_INDICATOR_HTM_OR_AFS",
    "IF_AFS_THEN_FV_BALANCE",
    "CUSTOMER_PARENT",
    "AMORTIZATION_METHOD",
    "COF_FTP_RATE",
    "SPREAD",
    "FED_CALL_CODE",
    "ZIP_CODE",
    "REAL_ESTATE_ZIP_CODE",
    "PCT_OWNED",
    "MATURITY_REPORTING",
    "MATURITY_BUCKETS",
    "PAST_DUE_YN",
    "NUMBER_OF_DAYS_PAST_DUE",
    "RB_SECURED_DE",
    "RB_ACCTG_METD_DESC",
    "NON_ACCRUAL_YN",
    "DATE_NON_ACCRUAL",
    "TDR_YN",
    "DATE_TDR",
    "TDR_COMP_WITH_MOD_TERMS_YN",
    "TDR_TYPE",
    "GOVT_GUARANTEED_AGENCY",
    "GOVT_GUARANTEED_PERCENTAGE",
    "US_GAAP_RISK_RATING",
    "IFRS_RISK_RATING",
    "IN_PROCESS_OF_FORECLOSURE",
    "ACQUIRED_IN_BUS_COMBINATION_YN",
    "SOP03_3_ACCTNG_TREATMENT_YN",
    "FV_LN_ACQ_IN_BUS_COMB_AT_ACQSN",
    "GROSS_CNTRCT_AMT_REC_AT_ACQSN",
    "ESTCNTRCL_CSFLW_NOEXPCTD2BCLTD",
    "SYNDICATED_PARTICIPATED_LOAN",
    "AGENT_PARTICIPANT",
    "PORTION_OF_SYNDICATED_LOAN_HFS",
    "UMD_3",
    "UMD_4",
    "UMD_5",
    "CO_BORROWER_ID",
    "CO_BORROWER_NAME",
    "RELATIONSHIP_MANAGER_NAME",
    "NAICS_CODE",
    "NAICS_DESC",
    "INDUSTRIES",
    "RAPID_COLLATERAL_TYPE",
    "FAC_LEVEL_LINK",
    "RB_FAC_NAME",
    "FACILITY_BORROWER_CIF",
    "FACILITY_BORROWER_NAME",
    "FACILITY_TRADE_ID",
    "FAC_OUTSTANDING_AVAILABLE_AMT",
    "FACILITY_LIMIT_AMOUNT",
    "FACILITY_USED_AMOUNT",
    "FACILITY_ORIGINAL_CURRENCY",
    "FAC_OUTSTANDING_GL_ORI_CUR_AMT",
    "FACILITY_START_DATE",
    "FACILITY_END_DATE",
    "LENDER_TYPE_DESC",
    "GLOBAL_SECTOR",
    "LOCAL_SECTOR",
    "REGULATORY_RISK_RATING",
    "VARIABLE_INTEREST_ENTITY",
    "UMD_7",
    "UMD_8",
    "UMD_9",
    "TRADE_ID",
    "PROD_GROUP",
    "ACBS_LENDER_TYPE",
    "FED_CALL_CODE2",
    "RESCOUNTRY_OF_CUSTOMER",
    "CIF_TYPE",
    "CIF_DESCRIPTION_PHOENIX",
    "CODE_OF_PARENT_PHOENIX",
    "DESC_OF_PARENT_PHOENIX",
    "RESCOUNTRY_OF_PARENT",
    "PORTFOLIO",
    "PRODUCT_TYPE",
    "IS_REPORTABLE_LOAN_YN",
    "BU",
    "ACCOUNT",
    "PRODUCT",
    "OPERATING_UNIT",
    "DEPTID",
    "AFFILIATE",
    "OBU_AFFILIATE",
    "CUST_CLASS",
    "CODEBLOCK",
    "DEFERRED_CODEBLOCK",
    "RESERVE_CODEBLOCK",
    "DESCRIPTION",
    "FILLER_1",
    "FILLER_2",
    "FILLER_3",
    "FILLER_4",
    "FILLER_5",
    "FILLER_6",
    "FILLER_7",
    "FILLER_8",
    "FILLER_9",
    "FILLER_10",
    "FILLER_11",
    "FILLER_12",
    "FILLER_13",
    "FILLER_14",
    "FILLER_15",
    "FILLER_16",
    "FILLER_17",
    "FILLER_18",
    "FILLER_19",
    "FILLER_20",
    "FILLER_21",
    "FILLER_22",
    "FILLER_23",
    "FILLER_24",
    "FILLER_25",
    "PROVENIENZA",
    "USERUPD",
    "DATEUPD"
) AS 
  SELECT
    RB_F_TGK_CREATE_SCENARIO_CODE(KEYS.MONTH_END_DATE) AS COD_SCENARIO,
    RB_F_TGK_CREATE_PERIOD_CODE(KEYS.MONTH_END_DATE) AS COD_PERIODO,
    RB_F_TGK_SANITIZE_CODE(DATA01.BUSINESS_UNIT) AS COD_AZIENDA,
    RB_F_TGK_SANITIZE_CODE(DATA02.AFFILIATE) AS COD_AZI_CTP,
    RB_F_TGK_SANITIZE_CODE(DATA02.ACCOUNT) AS COD_CONTO,
    'ORI' AS COD_CATEGORIA,
    RB_F_TGK_SANITIZE_CODE(DATA01.GL_KEY_CODE) AS COD_DEST1,
    CASE
        WHEN DATA02.OPERATING_UNIT IS NOT NULL THEN 'BLC_'||RB_F_TGK_SANITIZE_CODE(DATA02.OPERATING_UNIT) 
        WHEN DATA02.DEPTID IS NOT NULL THEN 'DPT_'||RB_F_TGK_SANITIZE_CODE(DATA02.DEPTID) 
        ELSE RB_F_TGK_SANITIZE_CODE(NULL)
    END AS COD_DEST2,
    RB_F_TGK_SANITIZE_CODE(DATA02.OBU_AFFILIATE) AS COD_DEST2_CTP,
    RB_F_TGK_SANITIZE_CODE(DATA02.PRODUCT) AS COD_DEST3,
    RB_F_TGK_SANITIZE_CODE(DATA02.CUST_CLASS) AS COD_DEST4,
    RB_F_TGK_SANITIZE_CODE(DATA01.CALL_CODE) AS COD_DEST5,
    A.COD_VALUTA,
    DATA01.CURRENCY_CODE AS COD_VALUTA_ORIGINARIA,
    KEYS.RB_ROWID,
    DATA01.MONTH_END_DATE,
    KEYS.REPORTING_ENTITY,
    RB_F_TGK_SANITIZE_CODE(KEYS.REPORTING_ENTITY) AS COD_REPORTING_ENTITY,
    DATA01.INSTRUMENT,
    DATA01.INTERCOMPANY,
    DATA01.CALL_CODE,
    DATA01.CALL_CODE_DESC,
    DATA01.BASE_EQUIVALENT,
    DATA01.PROD_GROUP_DESC,
    DATA01.PROD_GROUP_TYPE_DESC,
    DATA01.CUSTOMER_ID,
    DATA01.CUSTOMER_NAME,
    DATA01.CUSTOMER_TYPE,
    DATA01.RELATED_DEP_INST_YESNO,
    DATA01.PURPOSE_CODE,
    DATA01.FOREIGN_DOMESTIC,
    DATA01.CUST_PARENT_FOREIGN_DOMESTIC,
    DATA01.COUNTRY_CODE,
    DATA01.COUNTRY_DESC,
    DATA01.RISK_COUNTRY,
    DATA01.OPERATING_STATE,
    DATA01.LOAN_USED_IN_STATE,
    DATA01.BORROWER_COUNTY,
    DATA01.LOAN_USED_IN_COUNTY,
    DATA01.AFFL_CONSOL_NODE,
    DATA01.DAY_COUNT_BASIS,
    DATA01.SOURCE,
    DATA01.HIGHLVL_PROD_CAT,
    DATA01.GL_KEY_CODE,
    DATA01.GL_KEY_CODE_DESC,
    DATA01.PRINCIPAL_GL_US_GAAP_BASE_EQ,
    DATA01.ACC_INT_GL_US_GAAP_BASE_EQ,
    DATA01.DEF_FEES_GL_US_GAAP_BASE_EQ,
    DATA01.UNEARN_FEES_GL_US_GAAP_BASE_EQ,
    DATA01.SPCFC_RESRV_GL_US_GAAP_BASE_EQ,
    DATA01.INT_INC_GL_US_GAAP_BASE_EQ,
    DATA01.FEES_GL_US_GAAP_BASE_EQ,
    DATA01.PRINCIPAL_GL_IFRS_BASE_EQ,
    DATA01.ACC_INT_GL_IFRS_BASE_EQ,
    DATA01.DEFERRED_FEES_GL_IFRS_BASE_EQ,
    DATA01.UNEARNED_FEES_GL_IFRS_BASE_EQ,
    DATA01.SPCFC_RESRV_GL_IFRS_BASE_EQ,
    DATA01.INT_INC_GL_IFRS_BASE_EQ,
    DATA01.FEES_GL_IFRS_BASE_EQ,
    DATA01.UMD1,
    DATA01.UMD2,
    DATA01.UMD3,
    DATA01.CONSOL_NODE,
    DATA01.SUB_LE1,
    DATA01.SUB_LE2,
    DATA01.BUSINESS_UNIT,
    DATA01.BUSINESS_LINE,
    DATA01.CURRENCY_CODE,
    DATA01.LEGAL_CUST_TOTAL_COMMIT,
    DATA01.LEGAL_CUST_PRINC_FUNDED,
    DATA01.LEGAL_CUST_UNFUNDED_COMMIT,
    DATA01.LEGAL_CUST_INT_OWED,
    DATA01.BANK_SHARE_PRINC_IFRS,
    DATA01.BANK_SHARE_PRINC_US_GAAP,
    DATA01.BANK_SHARE_TOTAL_COMMIT,
    DATA01.BANK_SHARE_UNFUNDED_COMMIT,
    DATA01.BANK_SPECIFIC_RESRV_US_GAAP,
    DATA01.UNEARNED_FEES_US_GAAP,
    DATA01.CHARGED_OFF_US_GAAP,
    DATA01.CHARGED_OFF_IFRS,
    DATA01.SPECIFIC_RESRV_IFRS,
    DATA01.NON_ACC_INTEREST_DIFF_US_GAAP,
    DATA01.INTEREST_APPLIED_PRINC_US_GAAP,
    DATA01.NON_ACC_INTEREST_DIFF_IFRS,
    DATA01.INTEREST_APPLLIED_PRINC_IFRS,
    DATA01.UNEARNED_FEE_IFRS,
    DATA01.LEDGER_ACCRUED_INTEREST_IFRS,
    DATA01.LEDG_ACC_INTEREST_US_GAAP,
    DATA01.INTEREST_PL_MTD_IFRS,
    DATA01.INTEREST_PL_MTD_US_GAAP,
    DATA01.INTEREST_PL_QTD_IFRS,
    DATA01.INTEREST_PL_QTD_US_GAAP,
    DATA01.INTEREST_PL_YTD_IFRS,
    DATA01.INTEREST_PL_YTD_US_GAAP,
    DATA01.ORIGINAL_PREMIUM_DISCOUNT,
    DATA01.REMAINING_PREMIUM_DISCOUNT,
    DATA01.ORIGINATION_DATE,
    DATA01.MATURITY_DATE,
    DATA01.ORIGINAL_INTEREST_RATE,
    DATA01.REVOLVER_YN,
    DATA01.RATE_EFFECTIVE_DATE,
    DATA01.RATE_EXPIRATION_DATE,
    DATA01.INTEREST_RATE,
    DATA01.OVER_UNDER_RATE_INDEX,
    DATA01.NOTE_CEILING_RATE,
    DATA01.NOTE_FLOOR_RATE,
    DATA01.NEXT_RATE_RESET_DATE,
    DATA01.LAST_RATE_RESET_DATE,
    DATA01.RATE_RESET_FREQUENCY,
    DATA01.LAST_REPRICING_DATE,
    DATA01.RB_INDEX,
    DATA01.FIXED_OR_VARIABLE,
    DATA01.BOOK_INDICATOR_HTM_OR_AFS,
    DATA01.IF_AFS_THEN_FV_BALANCE,
    DATA01.CUSTOMER_PARENT,
    DATA01.AMORTIZATION_METHOD,
    DATA01.COF_FTP_RATE,
    DATA01.SPREAD,
    DATA01.FED_CALL_CODE,
    DATA01.ZIP_CODE,
    DATA01.REAL_ESTATE_ZIP_CODE,
    DATA01.PCT_OWNED,
    DATA01.MATURITY_REPORTING,
    DATA01.MATURITY_BUCKETS,
    DATA01.PAST_DUE_YN,
    DATA02.NUMBER_OF_DAYS_PAST_DUE,
    DATA02.RB_SECURED_DE,
    DATA02.RB_ACCTG_METD_DESC,
    DATA02.NON_ACCRUAL_YN,
    DATA02.DATE_NON_ACCRUAL,
    DATA02.TDR_YN,
    DATA02.DATE_TDR,
    DATA02.TDR_COMP_WITH_MOD_TERMS_YN,
    DATA02.TDR_TYPE,
    DATA02.GOVT_GUARANTEED_AGENCY,
    DATA02.GOVT_GUARANTEED_PERCENTAGE,
    DATA02.US_GAAP_RISK_RATING,
    DATA02.IFRS_RISK_RATING,
    DATA02.IN_PROCESS_OF_FORECLOSURE,
    DATA02.ACQUIRED_IN_BUS_COMBINATION_YN,
    DATA02.SOP03_3_ACCTNG_TREATMENT_YN,
    DATA02.FV_LN_ACQ_IN_BUS_COMB_AT_ACQSN,
    DATA02.GROSS_CNTRCT_AMT_REC_AT_ACQSN,
    DATA02.ESTCNTRCL_CSFLW_NOEXPCTD2BCLTD,
    DATA02.SYNDICATED_PARTICIPATED_LOAN,
    DATA02.AGENT_PARTICIPANT,
    DATA02.PORTION_OF_SYNDICATED_LOAN_HFS,
    DATA02.UMD_3,
    DATA02.UMD_4,
    DATA02.UMD_5,
    DATA02.CO_BORROWER_ID,
    DATA02.CO_BORROWER_NAME,
    DATA02.RELATIONSHIP_MANAGER_NAME,
    DATA02.NAICS_CODE,
    DATA02.NAICS_DESC,
    DATA02.INDUSTRIES,
    DATA02.RAPID_COLLATERAL_TYPE,
    DATA02.FAC_LEVEL_LINK,
    DATA02.RB_FAC_NAME,
    DATA02.FACILITY_BORROWER_CIF,
    DATA02.FACILITY_BORROWER_NAME,
    DATA02.FACILITY_TRADE_ID,
    DATA02.FAC_OUTSTANDING_AVAILABLE_AMT,
    DATA02.FACILITY_LIMIT_AMOUNT,
    DATA02.FACILITY_USED_AMOUNT,
    DATA02.FACILITY_ORIGINAL_CURRENCY,
    DATA02.FAC_OUTSTANDING_GL_ORI_CUR_AMT,
    DATA02.FACILITY_START_DATE,
    DATA02.FACILITY_END_DATE,
    DATA02.LENDER_TYPE_DESC,
    DATA02.GLOBAL_SECTOR,
    DATA02.LOCAL_SECTOR,
    DATA02.REGULATORY_RISK_RATING,
    DATA02.VARIABLE_INTEREST_ENTITY,
    DATA02.UMD_7,
    DATA02.UMD_8,
    DATA02.UMD_9,
    DATA02.TRADE_ID,
    DATA02.PROD_GROUP,
    DATA02.ACBS_LENDER_TYPE,
    DATA02.FED_CALL_CODE2,
    DATA02.RESCOUNTRY_OF_CUSTOMER,
    DATA02.CIF_TYPE,
    DATA02.CIF_DESCRIPTION_PHOENIX,
    DATA02.CODE_OF_PARENT_PHOENIX,
    DATA02.DESC_OF_PARENT_PHOENIX,
    DATA02.RESCOUNTRY_OF_PARENT,
    DATA02.PORTFOLIO,
    DATA02.PRODUCT_TYPE,
    DATA02.IS_REPORTABLE_LOAN_YN,
    DATA02.BU,
    DATA02.ACCOUNT,
    DATA02.PRODUCT,
    DATA02.OPERATING_UNIT,
    DATA02.DEPTID,
    DATA02.AFFILIATE,
    DATA02.OBU_AFFILIATE,
    DATA02.CUST_CLASS,
    DATA02.CODEBLOCK,
    DATA02.DEFERRED_CODEBLOCK,
    DATA02.RESERVE_CODEBLOCK,
    DATA02.DESCRIPTION,
    DATA02.FILLER_1,
    DATA02.FILLER_2,
    DATA02.FILLER_3,
    DATA02.FILLER_4,
    DATA02.FILLER_5,
    DATA02.FILLER_6,
    DATA02.FILLER_7,
    DATA02.FILLER_8,
    DATA02.FILLER_9,
    DATA02.FILLER_10,
    DATA02.FILLER_11,
    DATA02.FILLER_12,
    DATA02.FILLER_13,
    DATA02.FILLER_14,
    DATA02.FILLER_15,
    DATA02.FILLER_16,
    DATA02.FILLER_17,
    DATA02.FILLER_18,
    DATA02.FILLER_19,
    DATA02.FILLER_20,
    DATA02.FILLER_21,
    DATA02.FILLER_22,
    DATA02.FILLER_23,
    DATA02.FILLER_24,
    DATA02.FILLER_25,
    DATA02.PROVENIENZA,
    DATA02.USERUPD,
    DATA02.DATEUPD
FROM
    (
        SELECT DISTINCT
          MONTH_END_DATE,
          REPORTING_ENTITY,
          RB_ROWID
        FROM
          RB_HST_LOAN_01
    ) KEYS
    INNER JOIN
    (
        SELECT
            "RB_ROWID", 
            "MONTH_END_DATE", 
            "REPORTING_ENTITY", 
            "INSTRUMENT", 
            "INTERCOMPANY", 
            "CALL_CODE", 
            "CALL_CODE_DESC", 
            "BASE_EQUIVALENT", 
            "PROD_GROUP_DESC", 
            "PROD_GROUP_TYPE_DESC", 
            "CUSTOMER_ID", 
            "CUSTOMER_NAME", 
            "CUSTOMER_TYPE", 
            "RELATED_DEP_INST_YESNO", 
            "PURPOSE_CODE", 
            "FOREIGN_DOMESTIC", 
            "CUST_PARENT_FOREIGN_DOMESTIC", 
            "COUNTRY_CODE", 
            "COUNTRY_DESC", 
            "RISK_COUNTRY", 
            "OPERATING_STATE", 
            "LOAN_USED_IN_STATE", 
            "BORROWER_COUNTY", 
            "LOAN_USED_IN_COUNTY", 
            "AFFL_CONSOL_NODE", 
            "DAY_COUNT_BASIS", 
            "SOURCE", 
            "HIGHLVL_PROD_CAT", 
            "GL_KEY_CODE", 
            "GL_KEY_CODE_DESC", 
            "PRINCIPAL_GL_US_GAAP_BASE_EQ", 
            "ACC_INT_GL_US_GAAP_BASE_EQ", 
            "DEF_FEES_GL_US_GAAP_BASE_EQ", 
            "UNEARN_FEES_GL_US_GAAP_BASE_EQ", 
            "SPCFC_RESRV_GL_US_GAAP_BASE_EQ", 
            "INT_INC_GL_US_GAAP_BASE_EQ", 
            "FEES_GL_US_GAAP_BASE_EQ", 
            "PRINCIPAL_GL_IFRS_BASE_EQ", 
            "ACC_INT_GL_IFRS_BASE_EQ", 
            "DEFERRED_FEES_GL_IFRS_BASE_EQ", 
            "UNEARNED_FEES_GL_IFRS_BASE_EQ", 
            "SPCFC_RESRV_GL_IFRS_BASE_EQ", 
            "INT_INC_GL_IFRS_BASE_EQ", 
            "FEES_GL_IFRS_BASE_EQ", 
            "UMD1", 
            "UMD2", 
            "UMD3", 
            "CONSOL_NODE", 
            "SUB_LE1", 
            "SUB_LE2", 
            "BUSINESS_UNIT", 
            "BUSINESS_LINE", 
            "CURRENCY_CODE", 
            "LEGAL_CUST_TOTAL_COMMIT", 
            "LEGAL_CUST_PRINC_FUNDED", 
            "LEGAL_CUST_UNFUNDED_COMMIT", 
            "LEGAL_CUST_INT_OWED", 
            "BANK_SHARE_PRINC_IFRS", 
            "BANK_SHARE_PRINC_US_GAAP", 
            "BANK_SHARE_TOTAL_COMMIT", 
            "BANK_SHARE_UNFUNDED_COMMIT", 
            "BANK_SPECIFIC_RESRV_US_GAAP", 
            "UNEARNED_FEES_US_GAAP", 
            "CHARGED_OFF_US_GAAP", 
            "CHARGED_OFF_IFRS", 
            "SPECIFIC_RESRV_IFRS", 
            "NON_ACC_INTEREST_DIFF_US_GAAP", 
            "INTEREST_APPLIED_PRINC_US_GAAP", 
            "NON_ACC_INTEREST_DIFF_IFRS", 
            "INTEREST_APPLLIED_PRINC_IFRS", 
            "UNEARNED_FEE_IFRS", 
            "LEDGER_ACCRUED_INTEREST_IFRS", 
            "LEDG_ACC_INTEREST_US_GAAP", 
            "INTEREST_PL_MTD_IFRS", 
            "INTEREST_PL_MTD_US_GAAP", 
            "INTEREST_PL_QTD_IFRS", 
            "INTEREST_PL_QTD_US_GAAP", 
            "INTEREST_PL_YTD_IFRS", 
            "INTEREST_PL_YTD_US_GAAP", 
            "ORIGINAL_PREMIUM_DISCOUNT", 
            "REMAINING_PREMIUM_DISCOUNT", 
            "ORIGINATION_DATE", 
            "MATURITY_DATE", 
            "ORIGINAL_INTEREST_RATE", 
            "REVOLVER_YN", 
            "RATE_EFFECTIVE_DATE", 
            "RATE_EXPIRATION_DATE", 
            "INTEREST_RATE", 
            "OVER_UNDER_RATE_INDEX", 
            "NOTE_CEILING_RATE", 
            "NOTE_FLOOR_RATE", 
            "NEXT_RATE_RESET_DATE", 
            "LAST_RATE_RESET_DATE", 
            "RATE_RESET_FREQUENCY", 
            "LAST_REPRICING_DATE", 
            "RB_INDEX", 
            "FIXED_OR_VARIABLE", 
            "BOOK_INDICATOR_HTM_OR_AFS", 
            "IF_AFS_THEN_FV_BALANCE", 
            "CUSTOMER_PARENT", 
            "AMORTIZATION_METHOD", 
            "COF_FTP_RATE", 
            "SPREAD", 
            "FED_CALL_CODE", 
            "ZIP_CODE", 
            "REAL_ESTATE_ZIP_CODE", 
            "PCT_OWNED", 
            "MATURITY_REPORTING", 
            "MATURITY_BUCKETS", 
            "PAST_DUE_YN",
            "PROVENIENZA", 
            "USERUPD", 
            "DATEUPD"
        FROM
          RB_HST_LOAN_01
    ) DATA01
      ON
        KEYS.MONTH_END_DATE = DATA01.MONTH_END_DATE
        AND KEYS.REPORTING_ENTITY = DATA01.REPORTING_ENTITY
        AND KEYS.RB_ROWID = DATA01.RB_ROWID
    INNER JOIN
    (
        SELECT
            "RB_ROWID", 
            "MONTH_END_DATE", 
            "REPORTING_ENTITY", 
            "NUMBER_OF_DAYS_PAST_DUE", 
            "RB_SECURED_DE", 
            "RB_ACCTG_METD_DESC", 
            "NON_ACCRUAL_YN", 
            "DATE_NON_ACCRUAL", 
            "TDR_YN", 
            "DATE_TDR", 
            "TDR_COMP_WITH_MOD_TERMS_YN", 
            "TDR_TYPE", 
            "GOVT_GUARANTEED_AGENCY", 
            "GOVT_GUARANTEED_PERCENTAGE", 
            "US_GAAP_RISK_RATING", 
            "IFRS_RISK_RATING", 
            "IN_PROCESS_OF_FORECLOSURE", 
            "ACQUIRED_IN_BUS_COMBINATION_YN", 
            "SOP03_3_ACCTNG_TREATMENT_YN", 
            "FV_LN_ACQ_IN_BUS_COMB_AT_ACQSN", 
            "GROSS_CNTRCT_AMT_REC_AT_ACQSN", 
            "ESTCNTRCL_CSFLW_NOEXPCTD2BCLTD", 
            "SYNDICATED_PARTICIPATED_LOAN", 
            "AGENT_PARTICIPANT", 
            "PORTION_OF_SYNDICATED_LOAN_HFS", 
            "UMD_3", 
            "UMD_4", 
            "UMD_5", 
            "CO_BORROWER_ID", 
            "CO_BORROWER_NAME", 
            "RELATIONSHIP_MANAGER_NAME", 
            "NAICS_CODE", 
            "NAICS_DESC", 
            "INDUSTRIES", 
            "RAPID_COLLATERAL_TYPE", 
            "FAC_LEVEL_LINK", 
            "RB_FAC_NAME", 
            "FACILITY_BORROWER_CIF", 
            "FACILITY_BORROWER_NAME", 
            "FACILITY_TRADE_ID", 
            "FAC_OUTSTANDING_AVAILABLE_AMT", 
            "FACILITY_LIMIT_AMOUNT", 
            "FACILITY_USED_AMOUNT", 
            "FACILITY_ORIGINAL_CURRENCY", 
            "FAC_OUTSTANDING_GL_ORI_CUR_AMT", 
            "FACILITY_START_DATE", 
            "FACILITY_END_DATE", 
            "LENDER_TYPE_DESC", 
            "GLOBAL_SECTOR", 
            "LOCAL_SECTOR", 
            "REGULATORY_RISK_RATING", 
            "VARIABLE_INTEREST_ENTITY", 
            "UMD_7", 
            "UMD_8", 
            "UMD_9", 
            "TRADE_ID", 
            "PROD_GROUP", 
            "ACBS_LENDER_TYPE", 
            "FED_CALL_CODE2", 
            "RESCOUNTRY_OF_CUSTOMER", 
            "CIF_TYPE", 
            "CIF_DESCRIPTION_PHOENIX", 
            "CODE_OF_PARENT_PHOENIX", 
            "DESC_OF_PARENT_PHOENIX", 
            "RESCOUNTRY_OF_PARENT", 
            "PORTFOLIO", 
            "PRODUCT_TYPE", 
            "IS_REPORTABLE_LOAN_YN", 
            "BU", 
            "ACCOUNT", 
            "PRODUCT", 
            "OPERATING_UNIT", 
            "DEPTID", 
            "AFFILIATE", 
            "OBU_AFFILIATE", 
            "CUST_CLASS", 
            "CODEBLOCK", 
            "DEFERRED_CODEBLOCK", 
            "RESERVE_CODEBLOCK", 
            "DESCRIPTION", 
            "FILLER_1", 
            "FILLER_2", 
            "FILLER_3", 
            "FILLER_4", 
            "FILLER_5", 
            "FILLER_6", 
            "FILLER_7", 
            "FILLER_8", 
            "FILLER_9", 
            "FILLER_10", 
            "FILLER_11", 
            "FILLER_12", 
            "FILLER_13", 
            "FILLER_14", 
            "FILLER_15", 
            "FILLER_16", 
            "FILLER_17", 
            "FILLER_18", 
            "FILLER_19", 
            "FILLER_20", 
            "FILLER_21", 
            "FILLER_22", 
            "FILLER_23", 
            "FILLER_24", 
            "FILLER_25", 
            "PROVENIENZA", 
            "USERUPD", 
            "DATEUPD"
        FROM
          RB_HST_LOAN_02
    ) DATA02
    ON
        KEYS.MONTH_END_DATE = DATA02.MONTH_END_DATE
        AND KEYS.REPORTING_ENTITY = DATA02.REPORTING_ENTITY
        AND KEYS.RB_ROWID = DATA02.RB_ROWID
    LEFT OUTER JOIN
    AZIENDA A
    ON
        RB_F_TGK_SANITIZE_CODE(DATA01.BUSINESS_UNIT) = A.COD_AZIENDA
;
